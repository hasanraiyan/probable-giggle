<%- include('partials/header', { title: 'Website Monitor Dashboard' }) %>

<div class="bg-white p-6 rounded-lg shadow-md mb-8">
  <h2 class="text-2xl font-semibold mb-4">Add a New Site to Monitor</h2>
  <form action="/add" method="POST" class="flex flex-col sm:flex-row items-center">
    <input type="url" name="url" placeholder="https://example.com" class="flex-grow w-full sm:w-auto p-2 border rounded-md sm:rounded-l-md sm:rounded-r-none focus:outline-none focus:ring-2 focus:ring-blue-500 mb-2 sm:mb-0" required>
    <button type="submit" class="w-full sm:w-auto bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-md sm:rounded-r-md sm:rounded-l-none">Add Site</button>
  </form>
</div>

<div class="bg-white p-6 rounded-lg shadow-md">
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-semibold">Monitored Sites</h2>
    <form action="/check-all" method="POST">
      <button type="submit" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-md text-sm">Check All Now</button>
    </form>
  </div>
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white" id="sites-table">
      <thead class="bg-gray-200">
        <tr>
          <th class="py-3 px-4 text-left font-semibold text-gray-700">URL</th>
          <th class="py-3 px-4 text-left font-semibold text-gray-700">Status</th>
          <th class="py-3 px-4 text-left font-semibold text-gray-700">Response Time</th>
          <th class="py-3 px-4 text-left font-semibold text-gray-700">Last Checked</th>
          <th class="py-3 px-4 text-left font-semibold text-gray-700">Details</th>
          <th class="py-3 px-4 text-left font-semibold text-gray-700">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (sites.length > 0) { %>
          <% sites.forEach(site => { %>
            <tr class="border-b hover:bg-gray-50">
              <td class="py-3 px-4"><a href="<%= site.url %>" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline"><%= site.url %></a></td>
              <td class="py-3 px-4">
                <% if (site.status === 'UP') { %>
                  <span class="bg-green-500 text-white text-xs font-semibold px-2.5 py-0.5 rounded-full">UP</span>
                <% } else if (site.status === 'DOWN') { %>
                  <span class="bg-red-500 text-white text-xs font-semibold px-2.5 py-0.5 rounded-full">DOWN</span>
                <% } else { %>
                  <span class="bg-gray-400 text-white text-xs font-semibold px-2.5 py-0.5 rounded-full">N/A</span>
                <% } %>
              </td>
              <td class="py-3 px-4"><%= site.response_time !== null ? `${site.response_time} ms` : 'N/A' %></td>
              <td class="py-3 px-4"><%= site.checked_at ? new Date(site.checked_at).toLocaleString() : 'Never' %></td>
              <td class="py-3 px-4 text-sm text-gray-600 truncate" style="max-width: 200px;"><%= site.details || '' %></td>
              <td class="py-3 px-4 flex items-center space-x-2">
                <form action="/check/<%= site.id %>" method="POST" class="m-0">
                  <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded">Check</button>
                </form>
                <a href="/site/<%= site.id %>" class="bg-gray-200 hover:bg-gray-300 text-gray-800 text-xs font-bold py-1 px-3 rounded">Logs</a>
                <form action="/delete/<%= site.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this site and all its logs?');">
                  <button type="submit" class="bg-red-500 hover:bg-red-600 text-white text-xs font-bold py-1 px-3 rounded">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="6" class="py-4 px-4 text-center text-gray-500">No sites are being monitored yet. Add one above to get started!</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<script src="/js/dashboard.js"></script>
<%- include('partials/footer') %>
